<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="common.css" type="text/css" />
  <script src="jquery-3.1.0.js" type="text/javascript"></script>
  <script src="jquery.lazy.js?v=1.7.9" type="text/javascript"></script>
  <title>音乐列表</title>
</head>
<body>
  <div class="title" id="title">音乐列表</div>

  <table class="normal" id="albumlist">
  </table>

  <script type="text/javascript" charset="utf-8">
    $(function() {
      var dataUrl = "album/list";

      $.get(dataUrl, function(albumlist, status) {
        var table = document.getElementById("albumlist");

        var seq = 0;
        var row = null;
        var cell = null;
        var decade = 0;

        row = table.insertRow();
        row.className = "topic";
        cell = row.insertCell();
        cell.className = "topic";
        cell.style = "vertical-align: top;";
        cell.innerText = "新建专辑";
        cell.colSpan = 5;

        row = table.insertRow();
        row.className = "noborder";
        cell = row.insertCell();
        cell.className = "noborder";
        cell.style = "width: 190px; text-align: center; vertical-align: top;";
        var div_image = document.createElement("div");
        div_image.style = "margin: 10px; width: 170px;"
        div_image.innerHTML = "<a href=\"add.html\"><img src=\"img/add.png\" alt=\"add\" width=\"100px\"/></a>";
        cell.appendChild(div_image);

        albumlist.forEach(function (album) {
          var listyear = new Date(album.listdate).getFullYear();
          if (Math.trunc(listyear / 10) > decade) {
            seq = 0;
            row = table.insertRow();
            row.className = "topic";
            decade = Math.trunc(listyear / 10);
            cell = row.insertCell();
            cell.className = "topic";
            cell.id = decade;
            cell.style = "vertical-align: top;";
            cell.innerText = "Year: " + decade * 10 + "-" + (decade * 10 + 9);
            cell.colSpan = 5;
            cell.addEventListener("click", function () {
              var rows = document.getElementsByTagName("tr");
              for (var i = 0; i < rows.length; i++) { 
                if (rows[i].id.startsWith(this.id))
                  if (rows[i].style.display == "none")
                    rows[i].style = "display: block;";
                  else
                    rows[i].style = "display: none;";
              }
              $("img.lazy").Lazy({
                visibleOnly: true,
                effect : "fadeIn"
              });
            });
            cell.addEventListener("mouseover", function () {
              this.style.cursor = "pointer";
            });
          }
          if (seq % 5 == 0) {
            row = table.insertRow();
            row.className = "noborder";
            row.style = "display: none;"
            row.id = decade + "." + seq;
          }
          var cell = row.insertCell();
          cell.className = "noborder";
          cell.style = "width: 190px; text-align: center; vertical-align: top;";
          var div_box = document.createElement("div");
          cell.appendChild(div_box);
          var div_image = document.createElement("div");
          div_image.style = "margin: 10px; "
          div_image.innerHTML = "<a href=\"edit.html?idalbum=" + album.idalbum + "\"><img class=\"lazy\" data-src=\"cover/" + album.covers[0].idcover + "\" alt=\"" + album.title + "\" width=\"150px\"/></a>";
          div_box.appendChild(div_image);
          var div_title = document.createElement("div");
          div_title.style = "margin: 0px; font-size: 12px;";
          div_title.innerText = album.title;
          div_box.appendChild(div_title);

          seq++;
        });
      });
    });
  </script>
</body>
</html>
