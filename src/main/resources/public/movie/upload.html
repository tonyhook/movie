<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="common.css" type="text/css" />
  <script src="jquery-3.1.0.js" type="text/javascript"></script>
  <title>电影数据上传</title>
</head>
<body>
  <div class="title">电影数据上传</div>
  <form action="movie/manualupdate" method="post" enctype="multipart/form-data">
    <table class="noborder">
      <tr class="noborder">
        <td class="noborder">来源</td>
        <td class="noborder" colspan="2"><select id="sourcelist" name="idsource" onchange="changesource();"></select></td>
      </tr>
      <tr class="noborder">
        <td class="noborder">下载模板</td>
        <td class="noborder"></td>
        <td class="noborder"><button id="download" name="action" value="download" type="submit">下载</button></td>
      </tr>
      <tr class="noborder">
        <td class="noborder">访问来源</td>
        <td class="noborder" colspan="2"><a id="sourceurl"></a></td>
      </tr>
      <tr class="noborder">
        <td class="noborder">选择文件</td>
        <td class="noborder"><input type="file" id="file" name="file" /></td>
        <td class="noborder"><button id="upload" name="action" value="upload" type="submit">上传</button></td>
      </tr>
    </table>
  </form>
  <script type="text/javascript" charset="utf-8">
    var sourcelist = null;

    function changesource() {
      var idsource = document.getElementById('sourcelist').value;
      sourcelist.forEach(function(source) {
        if (source.idsource == idsource) {
          var a_source = document.getElementById('sourceurl');
          a_source.textContent = source.url;
          a_source.href = source.url;
        }
      });
    };

    $(function() {
      var sourceUrl = "source/list";
      $.get(sourceUrl, function(data, status) {
        var select_source = document.getElementById("sourcelist");
        var opt_source = null;

        sourcelist = data;
        sourcelist.forEach(function(source) {
          if (source.automatic == 0) {
            opt_source = document.createElement("option");
            opt_source.value = source.idsource;
            opt_source.text = source.name;
            select_source.appendChild(opt_source);
          }
        });

        changesource();
      });
    });
  </script>
</body>
</html>
